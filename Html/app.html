// Html/app.html (inyectado) â€” Funciones comunes del front-end
function listOrdersLight(){
  const sh = getSheet(SHEETS.ORDERS);
  const values = sh.getDataRange().getValues();
  const out = [];
  for (let i=1;i<values.length;i++){
    const v = values[i];
    out.push({ orderId: v[0], createdAt: v[1], clientName: v[3], propertyAddress: v[6], status: v[2] });
  }
  return out;
}

function listFiles(orderId, type){
  const sh = getSheet(SHEETS.FILES);
  const values = sh.getDataRange().getValues();
  const out = [];
  for (let i=1;i<values.length;i++){
    if (values[i][1] === orderId && values[i][2] === type){
      out.push({fileId: values[i][0], name: values[i][3], url: values[i][4]});
    }
  }
  return out;
}

function uploadSignature(orderId, b64, filename){
  const r = uploadFile(orderId, b64, filename, 'signature');
  if (r.ok){
    // Guardar referencia en ORDERS.signatureFileId
    const shO = getSheet(SHEETS.ORDERS);
    const data = shO.getDataRange().getValues();
    for (let i=1;i<data.length;i++){
      if (data[i][0] === orderId){
        data[i][12] = r.fileId;
        shO.getRange(1,1,data.length,data[0].length).setValues(data);
        break;
      }
    }
  }
  return r;
}
