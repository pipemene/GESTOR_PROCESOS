<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dashboard | Blue Home Gestor</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      background-color: #eef3f8;
      font-family: 'Segoe UI', sans-serif;
    }
    header {
      background: linear-gradient(90deg, #003366 0%, #005fa3 100%);
      color: white;
      padding: 12px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .logo {
      width: 50px;
      border-radius: 8px;
      margin-right: 10px;
    }
    .module-card {
      border-radius: 15px;
      transition: all 0.3s;
      cursor: pointer;
      box-shadow: 0 3px 10px rgba(0,0,0,0.15);
    }
    .module-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 6px 15px rgba(0,0,0,0.2);
    }
    .card-icon {
      font-size: 40px;
      margin-bottom: 10px;
    }
    footer {
      background-color: #003366;
      color: white;
      padding: 10px;
      text-align: center;
      font-size: 0.9em;
    }
  </style>
</head>

<body>
  <header>
    <div class="d-flex align-items-center">
      <img src="https://i.imgur.com/FEBvZ6N.png" class="logo" alt="Logo Blue Home">
      <h4 class="mb-0">Gestor Blue Home â€” Panel Principal</h4>
    </div>
    <div>
      <span id="usuarioInfo" class="fw-semibold me-3"></span>
      <button class="btn btn-sm btn-light" onclick="cerrarSesion()">Cerrar SesiÃ³n</button>
    </div>
  </header>

  <main class="container mt-4">
    <div class="text-center mb-4">
      <h5 class="text-primary">Bienvenido al sistema de gestiÃ³n Blue Home</h5>
      <p class="text-muted">Selecciona un mÃ³dulo para continuar</p>
    </div>

    <div class="row g-4">
      <!-- ARRRENDAMIENTOS -->
      <div class="col-md-4">
        <div class="card text-center module-card p-4" onclick="ir('arrendamiento.html')">
          <div class="card-icon text-primary">ğŸ¢</div>
          <h5>Arrendamientos</h5>
          <p class="text-muted mb-0">CreaciÃ³n de Ã³rdenes y gestiÃ³n de solicitudes</p>
        </div>
      </div>

      <!-- REPARACIONES -->
      <div class="col-md-4">
        <div class="card text-center module-card p-4" onclick="ir('reparaciones.html')">
          <div class="card-icon text-success">ğŸ”§</div>
          <h5>Reparaciones</h5>
          <p class="text-muted mb-0">SupervisiÃ³n y control tÃ©cnico</p>
        </div>
      </div>

      <!-- CONTABILIDAD -->
      <div class="col-md-4">
        <div class="card text-center module-card p-4" onclick="ir('facturacion.html')">
          <div class="card-icon text-warning">ğŸ’°</div>
          <h5>Contabilidad</h5>
          <p class="text-muted mb-0">FacturaciÃ³n y cierre de Ã³rdenes</p>
        </div>
      </div>

      <!-- TÃ‰CNICOS -->
      <div class="col-md-4">
        <div class="card text-center module-card p-4" onclick="ir('tecnicos.html')">
          <div class="card-icon text-danger">ğŸ§°</div>
          <h5>TÃ©cnicos</h5>
          <p class="text-muted mb-0">Subida de fotos, firma y finalizaciÃ³n</p>
        </div>
      </div>

      <!-- REPORTES -->
      <div class="col-md-4">
        <div class="card text-center module-card p-4" onclick="ir('reportes.html')">
          <div class="card-icon text-info">ğŸ“Š</div>
          <h5>Reportes</h5>
          <p class="text-muted mb-0">Resumen de actividad y estadÃ­sticas</p>
        </div>
      </div>

      <!-- ADMINISTRADOR (SOLO PIPE) -->
      <div class="col-md-4" id="modAdmin">
        <div class="card text-center module-card p-4" onclick="ir('admin.html')">
          <div class="card-icon text-dark">ğŸ‘‘</div>
          <h5>Administrador</h5>
          <p class="text-muted mb-0">GestiÃ³n de usuarios y configuraciones</p>
        </div>
      </div>
    </div>

    <hr class="mt-5">
    <div class="text-center">
      <button class="btn btn-outline-primary" onclick="actualizarResumen()">ğŸ”„ Actualizar Resumen</button>
    </div>

    <div id="resumen" class="mt-4 text-center"></div>
  </main>

  <footer>
    Blue Home Inmobiliaria Â© 2025 â€” Todos los derechos reservados
  </footer>

  <script>
    const usuario = JSON.parse(localStorage.getItem("usuarioActivo") || "{}");

    // ğŸ”’ ValidaciÃ³n de sesiÃ³n
    if (!usuario.nombre) {
      window.location.href = "index.html";
    }

    // Mostrar nombre y rol
    document.getElementById("usuarioInfo").textContent =
      `${usuario.nombre.toUpperCase()} (${usuario.rol.toUpperCase()})`;

    // ğŸ”¹ Si NO es admin, ocultar mÃ³dulo de administraciÃ³n
    if (usuario.rol.toLowerCase() !== "admin") {
      document.getElementById("modAdmin").style.display = "none";
    }

    function ir(pagina) {
      window.location.href = pagina;
    }

    function cerrarSesion() {
      localStorage.clear();
      window.location.href = "index.html";
    }

    // ğŸ”¹ Resumen rÃ¡pido de Ã³rdenes
    async function actualizarResumen() {
      const res = await fetch("/api/orders");
      const data = await res.json();

      const pendientes = data.filter(o => o.estado?.toLowerCase() === "pendiente").length;
      const finalizadas = data.filter(o => o.estado?.toLowerCase() === "finalizada").length;

      document.getElementById("resumen").innerHTML = `
        <div class="alert alert-info">
          <h6>ğŸ“‹ Resumen General</h6>
          <p><b>Pendientes:</b> ${pendientes} | <b>Finalizadas:</b> ${finalizadas}</p>
        </div>
      `;
    }

    actualizarResumen();
  </script>
</body>
</html>
