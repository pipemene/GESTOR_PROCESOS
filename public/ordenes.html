<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Gestión de Órdenes | Blue Home Gestor</title>
  <link rel="stylesheet" href="assets/css/estilos.css" />
  <script src="https://unpkg.com/lucide@latest"></script>

  <style>
  /* ======== BASE GENERAL ======== */
  body {
    background: linear-gradient(145deg, #f5f8fb, #e9eef5);
    color: #1c2b4a;
    font-family: "Poppins", "Inter", sans-serif;
    margin: 0;
    min-height: 100vh;
    overflow-x: hidden;
  }

  /* ======== HEADER ======== */
  header {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    backdrop-filter: blur(10px);
    background: rgba(10, 60, 110, 0.92);
    color: white;
    padding: 18px 32px;
    display: flex;
    align-items: center;
    gap: 15px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
    z-index: 999;
    height: 85px;
  }

  header img {
    height: 42px;
  }

  header h1 {
    font-size: 1.4rem;
    font-weight: 600;
    margin: 0;
    letter-spacing: 0.3px;
  }

  /* ======== CONTENIDO PRINCIPAL ======== */
  main {
    margin-top: 130px !important; /* compensación total del header */
    padding: 25px;
    max-width: 1200px;
    margin-left: auto;
    margin-right: auto;
    transition: margin-top 0.3s ease;
  }

  /* ======== FORMULARIO ======== */
  .form-container {
    background: white;
    border-radius: 16px;
    box-shadow: 0 4px 18px rgba(0, 0, 0, 0.1);
    padding: 30px;
    margin-bottom: 25px;
  }

  .form-container h2 {
    margin: 0 0 15px;
    color: #0a3c6e;
    font-weight: 600;
  }

  .form-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: 15px;
    margin-bottom: 15px;
  }

  .form-grid input,
  .form-grid select,
  textarea {
    width: 100%;
    padding: 12px;
    border: 1.5px solid #d1d6de;
    border-radius: 8px;
    font-size: 0.95rem;
    color: #1c1c1c;
    background: #ffffff;
    outline: none;
    transition: all 0.3s ease;
  }

  .form-grid input::placeholder,
  textarea::placeholder {
    color: #7a7f89;
  }

  .form-grid input:focus,
  .form-grid select:focus,
  textarea:focus {
    border-color: #0a3c6e;
    box-shadow: 0 0 8px rgba(10, 60, 110, 0.25);
  }

  .form-actions {
    display: flex;
    justify-content: flex-end;
    gap: 15px;
    margin-top: 20px;
  }

  .form-actions button {
    background: #0a3c6e;
    color: white;
    border: none;
    border-radius: 8px;
    padding: 9px 18px;
    font-weight: 500;
    cursor: pointer;
    transition: 0.3s;
  }

  .form-actions button:hover {
    background: #164f9c;
  }

  /* ======== TABLA ======== */
  table {
    width: 100%;
    border-collapse: collapse;
    background: white;
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 3px 12px rgba(0, 0, 0, 0.1);
  }

  thead {
    background: #0a3c6e;
    color: #fff;
  }

  th, td {
    padding: 12px 15px;
    text-align: left;
    font-size: 0.95rem;
  }

  tr:nth-child(even) {
    background: #f8fafc;
  }

  tr:hover {
    background: #eef3ff;
  }

  .badge {
    padding: 4px 10px;
    border-radius: 8px;
    font-weight: 600;
    font-size: 0.85rem;
    color: #fff;
  }

  .badge.pendiente {
    background: #ff5c5c;
  }

  .badge.finalizada {
    background: #4caf50;
  }

  /* ======== RESPONSIVE ======== */
  @media (max-width: 768px) {
    header {
      flex-direction: row;
      justify-content: center;
      height: auto;
      padding: 12px 18px;
      text-align: center;
    }

    header h1 {
      font-size: 1.1rem;
    }

    main {
      margin-top: 140px !important;
      padding: 15px;
    }

    .form-container {
      padding: 22px;
    }

    th, td {
      font-size: 0.85rem;
    }
  }
</style>
</head>

<body>
  <header>
    <h1><img src="assets/img/logo-blanco.png" alt="Logo Blue Home" height="40" /> Órdenes</h1>
  </header>

  <main>
    <!-- FORMULARIO DE CREACIÓN -->
    <section class="form-container">
      <h2 style="margin-top:0;">Nueva Orden</h2>
      <div class="form-grid">
        <input type="text" id="cliente" placeholder="Cliente" value="BLUE HOME INMOBILIARIA" />
        <input type="text" id="telefono" placeholder="Teléfono" value="3012040465" />
        <input type="text" id="codigo" placeholder="Código" />
        <input type="date" id="fecha" />
        <select id="tecnico">
          <option value="">Sin asignar</option>
          <option value="Carlos">Carlos</option>
          <option value="Daniela">Daniela</option>
        </select>
        <select id="estado">
          <option value="Pendiente">Pendiente</option>
          <option value="Finalizada">Finalizada</option>
        </select>
      </div>

      <textarea id="descripcion" rows="3" placeholder="Descripción detallada de la orden..."></textarea>

      <div class="form-actions">
        <button id="btnLimpiar">Limpiar</button>
        <button id="btnCrear">Crear Orden</button>
      </div>
    </section>

    <!-- TABLA DE ÓRDENES -->
    <section>
      <table>
        <thead>
          <tr>
            <th>Fecha</th>
            <th>Código</th>
            <th>Cliente</th>
            <th>Teléfono</th>
            <th>Descripción</th>
            <th>Técnico</th>
            <th>Estado</th>
            <th>Acción</th>
          </tr>
        </thead>
        <tbody id="tablaOrdenes"></tbody>
      </table>
    </section>
  </main>

  <script>
    lucide.createIcons();

    // Cargar órdenes
    async function cargarOrdenes() {
      const resp = await fetch("/api/orders");
      const data = await resp.json();
      const tbody = document.getElementById("tablaOrdenes");
      tbody.innerHTML = "";

      if (!data.length) {
        tbody.innerHTML = `<tr><td colspan="8" style="text-align:center; padding:20px;">No hay órdenes registradas.</td></tr>`;
        return;
      }

      data.forEach(o => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${o.fecha}</td>
          <td>${o.codigo}</td>
          <td>${o.cliente}</td>
          <td>${o.telefono}</td>
          <td>${o.descripcion}</td>
          <td>${o.tecnico || "-"}</td>
          <td><span class="badge ${o.estado.toLowerCase()}">${o.estado}</span></td>
          <td><button>Ver / Gestionar</button></td>
        `;
        tbody.appendChild(tr);
      });
    }

    cargarOrdenes();

    // Crear nueva orden
    document.getElementById("btnCrear").addEventListener("click", async () => {
      const nueva = {
        cliente: document.getElementById("cliente").value,
        telefono: document.getElementById("telefono").value,
        codigo: document.getElementById("codigo").value,
        fecha: document.getElementById("fecha").value,
        descripcion: document.getElementById("descripcion").value,
        tecnico: document.getElementById("tecnico").value,
        estado: document.getElementById("estado").value
      };

      await fetch("/api/orders", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(nueva)
      });

      alert("✅ Orden creada correctamente");
      cargarOrdenes();
    });

    document.getElementById("btnLimpiar").addEventListener("click", () => {
      document.querySelectorAll("input, textarea, select").forEach(el => el.value = "");
    });
  </script>
</body>
</html>
