<div class="card p-6 bg-white rounded-2xl shadow">
  <h2 class="text-xl font-bold mb-4 text-blue-600">Nueva Orden</h2>
  <form id="ordenForm">
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <div>
        <label class="block font-semibold text-gray-700">C√≥digo del inmueble</label>
        <input type="text" id="codigo" class="w-full border rounded-lg p-2" required>
      </div>
      <div>
        <label class="block font-semibold text-gray-700">Arrendatario</label>
        <input type="text" id="arrendatario" class="w-full border rounded-lg p-2" required>
      </div>
      <div>
        <label class="block font-semibold text-gray-700">Tel√©fono</label>
        <input type="tel" id="telefono" class="w-full border rounded-lg p-2" required>
      </div>
      <div>
        <label class="block font-semibold text-gray-700">T√©cnico</label>
        <select id="tecnico" class="w-full border rounded-lg p-2">
          <option value="Sin asignar">Sin asignar</option>
        </select>
      </div>
    </div>
    <div class="mt-4">
      <label class="block font-semibold text-gray-700">Observaci√≥n</label>
      <textarea id="observacion" rows="3" class="w-full border rounded-lg p-2" placeholder="Describe brevemente el trabajo a realizar"></textarea>
    </div>
    <button type="submit" class="mt-5 bg-blue-600 hover:bg-blue-700 text-white font-semibold px-6 py-2 rounded-lg shadow">
      Crear Orden
    </button>
  </form>
</div>

<script>
  // üîπ Cargar t√©cnicos desde la API
  async function cargarTecnicos() {
    const token = localStorage.getItem("token");
    const res = await fetch('/api/users', { headers: { Authorization: `Bearer ${token}` } });
    const usuarios = await res.json();
    const tecnicos = usuarios.filter(u => u.rol.toLowerCase() === 'tecnico');
    const select = document.getElementById('tecnico');
    tecnicos.forEach(t => {
      const opt = document.createElement('option');
      opt.value = t.usuario;
      opt.textContent = t.usuario;
      select.appendChild(opt);
    });
  }

  // üîπ Crear orden
  document.getElementById('ordenForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    const token = localStorage.getItem("token");
    const data = {
      codigo: document.getElementById('codigo').value,
      arrendatario: document.getElementById('arrendatario').value,
      telefono: document.getElementById('telefono').value,
      observacion: document.getElementById('observacion').value,
      tecnico: document.getElementById('tecnico').value,
    };
    const res = await fetch('/api/orders', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json', Authorization: `Bearer ${token}` },
      body: JSON.stringify(data)
    });
    if (res.ok) {
      alert("‚úÖ Orden creada correctamente");
      document.getElementById('ordenForm').reset();
    } else {
      alert("‚ùå Error al crear la orden");
    }
  });

  // Inicializar
  cargarTecnicos();
</script>
